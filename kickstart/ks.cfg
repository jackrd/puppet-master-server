#Generated by Kickstart Configurator
#platform=AMD64 or Intel EM64T

#System language
lang en_US
#Language modules to install
langsupport en_US
#System keyboard
keyboard us
#System mouse
mouse
#System timezone
timezone Asia/Taipei
#Root password
rootpw 111111
#Initial user
user sw3 --fullname "" --password 111111
#Reboot after installation
reboot
#Use text mode install
text
#Install OS instead of upgrade
install
#Use Web installation
url --url http://192.168.0.1:8080/ubuntu/
#System bootloader configuration
bootloader --location=mbr 
#Clear the Master Boot Record
zerombr yes
#Partition clearing information
clearpart --all --initlabel 
#System authorization infomation
auth  --useshadow  --enablemd5 
#Network information
%include /tmp/network.ks
#Firewall configuration
firewall --disabled 
#Do not configure the X Window System
skipx

%pre
#!/bin/sh 

MAC_ADDR=$(ip link | grep link/ether | sed -n 1p | sed -e 's/^.*ether //g;s/ brd.*$//g')

if [ "$MAC_ADDR" == "1c:c1:de:74:9a:d4" ]
then

	echo "network --device=em1 --bootproto=static --ip=192.168.0.11 --netmask=255.255.255.0 --gateway=192.168.0.1 --nameserver=10.15.1.7 --hostname cntrnode" > /tmp/network.ks

elsif [ "$MAC_ADDR" == "1c:c1:de:73:6c:f0" ]
then

	echo "network --device=em1 --bootproto=static --ip=192.168.0.12 --netmask=255.255.255.0 --gateway=192.168.0.1 --nameserver=10.15.1.7 --hostname networknode" > /tmp/network.ks

elsif [ "$MAC_ADDR" == "1c:c1:de:02:5b:50" ]
then

	echo "network --device=em1 --bootproto=static --ip=192.168.0.13 --netmask=255.255.255.0 --gateway=192.168.0.1 --nameserver=10.15.1.7 --hostname comptnode" > /tmp/network.ks

fi
%end

%post --log=/root/post-log
#!/bin/sh 
echo "run  post script" > /tmp/posscript

#edit /etc/hosts
echo "192.168.0.11 cntrnode" >> /etc/hosts
echo "192.168.0.12 networknode" >> /etc/hosts
echo "192.168.0.13 comptnode" >> /etc/hosts
echo "192.168.0.1 puppetmaster" >> /etc/hosts

#install ssh and setup

#install puppet and setup
apt-get install puppet -y
apt-get agent -t 

#edit /etc/rc.local

%end

